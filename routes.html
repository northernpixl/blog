<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Map | NorthernPixl</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        /* Critical for map rendering: ensure container has height */
        html, body, #root { height: 100%; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        /* Map container needs explicit relative positioning and z-index for stacking context */
        .leaflet-container { width: 100%; height: 100%; background: #f8fafc; z-index: 0; position: relative; }
        
        /* Custom Popup Styles */
        .leaflet-popup-content-wrapper { border-radius: 1rem; padding: 0.5rem; }
        .leaflet-popup-content { margin: 0.5rem; width: 200px !important; }
        .custom-popup .title { font-weight: 900; font-size: 1rem; line-height: 1.2; margin-bottom: 0.25rem; }
        .custom-popup .meta { font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
        .custom-popup .link { display: inline-block; background: #0f172a; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 700; text-decoration: none; margin-top: 0.25rem; }
        
        .filter-btn.active { background-color: #0f172a; color: white; }
        .filter-btn { background-color: #f1f5f9; color: #64748b; }
    </style>
</head>
<body class="bg-white text-slate-900 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                camera: <><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></>,
                arrowRight: <><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></>,
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const WALKS = [
            { id: 101, category: "1-4", name: "Drake Stone Walk", length: "4 miles", difficulty: "Moderate", elevation: "150m", lat: 55.337, lng: -2.105, desc: "A mystical walk up to a massive sandstone boulder believed to have healing powers.", highlights: "The massive Drake Stone boulder, Harbottle Lake nature reserve.", route: [[55.3378100, -2.1179200]] },
            { id: 102, category: "1-4", name: "Yeavering Bell", length: "3.6 miles", difficulty: "Strenuous", elevation: "361m", lat: 55.545, lng: -2.112, desc: "A short but sharp climb to the summit of an Iron Age hillfort.", highlights: "Largest Iron Age hillfort in the region, wild Cheviot goats.", route: [[55.5679200, -2.1171600]] },
            { id: 103, category: "1-4", name: "Bamburgh Castle Circular", length: "3 miles", difficulty: "Easy", elevation: "20m", lat: 55.609, lng: -1.712, desc: "A classic coastal loop. Walk along the beach with the castle towering above you.", highlights: "Bamburgh Castle from the beach, The Wynding dunes.", route: [[55.6043500, -1.6970100]] },
            { id: 104, category: "1-4", name: "Berwick Walls", length: "1.5 miles", difficulty: "Easy", elevation: "10m", lat: 55.770, lng: -2.005, desc: "A complete circuit of the Elizabethan town walls.", highlights: "Elizabethan fortifications, Royal Border Bridge.", route: [[55.7722693, -2.0040788]] },
            { id: 105, category: "1-4", name: "Bolam Lake", length: "1 mile", difficulty: "Easy", elevation: "30m", lat: 55.127, lng: -1.865, desc: "A gentle circular walk around a beautiful lake and woodland.", highlights: "Bolam Lake reflections, Red Squirrels.", route: [[55.1326000, -1.8711100]] },
            { id: 106, category: "1-4", name: "Rothbury Riverside", length: "1.5 miles", difficulty: "Easy", elevation: "15m", lat: 55.309, lng: -1.912, desc: "Follows the River Coquet. Flat, easy walking with plenty of benches.", highlights: "River Coquet stepping stones, views of Simonside.", route: [[55.3077500, -1.9117100]] },
            { id: 107, category: "1-4", name: "Thirlwall Castle", length: "1.75 miles", difficulty: "Easy", elevation: "40m", lat: 54.989, lng: -2.535, desc: "Visit the ruins of a 14th-century castle built with stones from Hadrian's Wall.", highlights: "Thirlwall Castle ruins, Tipalt Burn.", route: [[54.985011, -2.528657]] },
            { id: 108, category: "1-4", name: "Falstone Circular", length: "2.5 miles", difficulty: "Moderate", elevation: "60m", lat: 55.185, lng: -2.438, desc: "A lovely route starting in the village of Falstone, following a section of the River Tyne Trail.", highlights: "Stell stone sculpture, River North Tyne.", route: [[55.1804900, -2.4356200]] },
            { id: 109, category: "1-4", name: "Hareshaw Linn", length: "3 miles", difficulty: "Moderate", elevation: "100m", lat: 55.149, lng: -2.222, desc: "A 'there and back' walk up to a magical wooded dene to a spectacular 30ft waterfall.", highlights: "Hareshaw Linn waterfall, ancient woodland.", route: [[55.145889, -2.253043]] },
            { id: 110, category: "1-4", name: "St Cuthbert's Cave", length: "2 miles", difficulty: "Moderate", elevation: "90m", lat: 55.617, lng: -1.928, desc: "Short walk to the sandstone cave where St Cuthbert's body was said to have been hidden.", highlights: "St Cuthbert's Cave, Kyloe Hills views.", route: [[55.6096200, -1.9203700]] },
            { id: 201, category: "4-7", name: "Dunstanburgh from Craster", length: "4.5 miles", difficulty: "Easy", elevation: "30m", lat: 55.472, lng: -1.593, desc: "The definitive coastal walk. From Craster harbor, along the flat grassy path to the castle.", highlights: "Craster Harbour, Dunstanburgh Castle.", route: [[55.4709900, -1.5957000]] },
            { id: 202, category: "4-7", name: "Allen Banks & Staward Gorge", length: "6.5 miles", difficulty: "Moderate", elevation: "190m", lat: 54.967, lng: -2.315, desc: "A stunning walk through the largest area of ancient woodland in Northumberland.", highlights: "Ancient Woodland, Staward Peel Ruins.", route: [[54.9704900, -2.3170200]] },
            { id: 203, category: "4-7", name: "Holy Island Loop", length: "5 miles", difficulty: "Moderate", elevation: "25m", lat: 55.671, lng: -1.796, desc: "A full circuit of Lindisfarne. Includes the Castle, the Priory, and the remote sand dunes.", highlights: "Lindisfarne Priory, Castle, Emmanuel Head pyramid.", route: [[55.6751500, -1.8010900]] },
            { id: 204, category: "4-7", name: "Doddington Moor", length: "4.5 miles", difficulty: "Moderate", elevation: "180m", lat: 55.578, lng: -2.005, desc: "Explore ancient cup and ring marked rocks and a mysterious stone circle.", highlights: "Ancient Rock Art, Doddington Stone Circle.", route: [[55.5852000, -2.0029100]] },
            { id: 205, category: "4-7", name: "Norham Castle", length: "4 miles", difficulty: "Easy", elevation: "40m", lat: 55.721, lng: -2.158, desc: "A riverside walk along the Tweed, looping back through the village of Norham.", highlights: "Norham Castle keep, River Tweed banks.", route: [[55.7192373, -2.1622550]] },
            { id: 206, category: "4-7", name: "Greenlee Lough", length: "4.5 miles", difficulty: "Moderate", elevation: "110m", lat: 55.025, lng: -2.368, desc: "A boardwalk section over the wetlands of the lough, followed by a climb up to Hadrian's Wall.", highlights: "Greenlee Lough boardwalk, Hadrian's Wall views.", route: [[55.0148600, -2.3945300]] },
            { id: 207, category: "4-7", name: "Hethas Hike", length: "4.5 miles", difficulty: "Strenuous", elevation: "250m", lat: 55.535, lng: -2.165, desc: "Deep in the College Valley. A challenging walk visiting the Hethas scenic area.", highlights: "College Valley isolation, Wild Goats, Elsdon Burn.", route: [[55.5461600, -2.1698900]] },
            { id: 208, category: "4-7", name: "Simonside Hills", length: "4.5 miles", difficulty: "Strenuous", elevation: "300m", lat: 55.289, lng: -1.948, desc: "A sandstone ridge offering 360-degree views. Steep stone steps lead to the summit cairn.", highlights: "Summit Cairn views, Heather moorland.", route: [[55.2832700, -1.9189300]] },
            { id: 209, category: "4-7", name: "Walltown Crags", length: "5 miles", difficulty: "Moderate", elevation: "150m", lat: 54.992, lng: -2.525, desc: "Some of the most dramatic sections of Hadrian's Wall. The route follows the roller-coaster crags.", highlights: "Walltown Crags, Roman Wall turrets.", route: [[54.9921600, -2.5014300]] },
            { id: 210, category: "4-7", name: "Wallington Estate", length: "4.5 miles", difficulty: "Easy", elevation: "50m", lat: 55.152, lng: -1.955, desc: "A long circular route inside and around the boundary of the National Trust estate.", highlights: "Wallington Hall grounds, River Wansbeck.", route: [[55.1542400, -1.9598900]] },
            { id: 301, category: "7+", name: "The Cheviot and Hedgehope", length: "11 miles", difficulty: "Very Strenuous", elevation: "911m", lat: 55.485, lng: -2.135, desc: "The big two. A serious undertaking to two of the highest points in Northumberland.", highlights: "The Cheviot Summit (815m), Scald Hill, Harthope Valley.", route: [[55.4964600, -2.0744500]] },
            { id: 302, category: "7+", name: "Windy Gyle", length: "7.5 miles", difficulty: "Strenuous", elevation: "619m", lat: 55.421, lng: -2.235, desc: "Start at the foot of Barrow Law just up from Barrowburn. A steady climb up The Street to the border ridge.", highlights: "Russell's Cairn, The Border Ridge, Views into Scotland.", route: [[55.3967500, -2.2231400]] },
            { id: 303, category: "7+", name: "Beadnell to Low Newton", length: "8.5 miles", difficulty: "Moderate", elevation: "20m", lat: 55.559, lng: -1.628, desc: "A long coastal walk along sandy bays. Visit the Ship Inn at Low Newton for lunch before heading back.", highlights: "Beadnell Bay, Football Hole beach, Ship Inn pub.", route: [[55.5524400, -1.6292200]] },
            { id: 304, category: "7+", name: "Steel Rigg to Housesteads", length: "7.5 miles", difficulty: "Strenuous", elevation: "350m", lat: 55.013, lng: -2.328, desc: "The classic Hadrian's Wall section. Includes Sycamore Gap site and the steepest crags.", highlights: "Sycamore Gap site, Crag Lough, Highshield Crags.", route: [[55.0031000, -2.3909000]] },
            { id: 305, category: "7+", name: "Alnmouth to Warkworth", length: "11.5 miles", difficulty: "Moderate", elevation: "80m", lat: 55.385, lng: -1.615, desc: "Walk from Alnmouth beach to the historic village of Warkworth and its castle, following the river and coast.", highlights: "Alnmouth Estuary, Warkworth Castle, Coastal Path.", route: [[55.3891400, -1.6063900]] },
            { id: 306, category: "7+", name: "Brough Law Hillforts", length: "10 miles", difficulty: "Strenuous", elevation: "300m", lat: 55.441, lng: -2.001, desc: "Ingram Valley. Explores Iron Age settlements and Linhope Spout waterfall.", highlights: "Brough Law Hillfort, Linhope Spout, Ingram Valley.", route: [[55.4410000, -1.9891500]] },
            { id: 307, category: "7+", name: "Cold Law", length: "7.5 miles", difficulty: "Strenuous", elevation: "450m", lat: 55.495, lng: -2.155, desc: "A wild walk into the dramatic Cheviots. Often deserted.", highlights: "Cold Law summit, Remote wilderness, Amazing views.", route: [[55.5191500, -2.0373400]] },
            { id: 308, category: "7+", name: "Hedgehope Hill", length: "7.5 miles", difficulty: "Strenuous", elevation: "714m", lat: 55.465, lng: -2.075, desc: "The second highest peak. Steeper and more conical than the Cheviot. Best views in the park by far.", highlights: "Hedgehope Hill summit, Langlee Crags, Housey Crags.", route: [[55.4975200, -2.0715100]] },
            { id: 309, category: "7+", name: "Pilgrim's Way - Holy Island", length: "8 miles", difficulty: "Moderate", elevation: "100m", lat: 55.655, lng: -1.885, desc: "Holy Island across the pilgrim's causeway over the mud flats. Please check tides!", highlights: "Pilgrim's Causeway, Holy Island mudflats.", route: [[55.67740, -1.89542]] },
            { id: 310, category: "7+", name: "The Schil", length: "12 miles", difficulty: "Very Strenuous", elevation: "601m", lat: 55.512, lng: -2.225, desc: "A distinctive rocky peak on the Scottish border. A real lung-buster.", highlights: "The Schil summit, Border Ridge.", route: [[55.4966821, -2.1890438]] }
        ];

        const App = () => {
            const mapContainerRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersLayerRef = useRef(null);
            const [activeFilter, setActiveFilter] = useState('all');

            const filteredWalks = useMemo(() => {
                if (activeFilter === 'all') return WALKS;
                if (activeFilter === '1-4') return WALKS.filter(w => w.category === '1-4');
                if (activeFilter === '4-7') return WALKS.filter(w => w.category === '4-7');
                if (activeFilter === '7+') return WALKS.filter(w => w.category === '7+');
                return WALKS;
            }, [activeFilter]);

            useEffect(() => {
                if (mapContainerRef.current && !mapInstanceRef.current) {
                    const map = L.map(mapContainerRef.current, { 
                        zoomControl: false,
                        center: [55.35, -2.0], // Center roughly on Northumberland
                        zoom: 9 
                    });
                    
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                        attribution: '&copy; OpenStreetMap'
                    }).addTo(map);

                    mapInstanceRef.current = map;
                    markersLayerRef.current = L.layerGroup().addTo(map);

                    // Fix for map loading correctly
                    setTimeout(() => {
                        map.invalidateSize();
                    }, 100);
                }
            }, []);

            useEffect(() => {
                if (!mapInstanceRef.current || !markersLayerRef.current) return;

                // Clear existing markers
                markersLayerRef.current.clearLayers();

                // Add filtered markers
                filteredWalks.forEach(walk => {
                    const color = walk.category === '1-4' ? '#22c55e' : // Green
                                  walk.category === '4-7' ? '#f59e0b' : // Orange
                                  '#ef4444'; // Red
                    
                    if (walk.route && walk.route.length > 0) {
                        const startPoint = walk.route[0];
                        const marker = L.circleMarker(startPoint, {
                            radius: 6,
                            fillColor: color,
                            color: "#fff",
                            weight: 2,
                            fillOpacity: 1
                        });

                        // Link logic with Deep Linking ID
                        const baseUrl = walk.category === '1-4' ? 'walks_short.html' :
                                        walk.category === '4-7' ? 'walks_medium.html' :
                                        'walks_long.html';
                        const linkUrl = `${baseUrl}?id=${walk.id}`;

                        const popupContent = `
                            <div class="custom-popup">
                                <div class="meta">${walk.length} â€¢ ${walk.difficulty}</div>
                                <div class="title">${walk.name}</div>
                                <a href="${linkUrl}" class="link">View Details</a>
                            </div>
                        `;
                        marker.bindPopup(popupContent);
                        marker.addTo(markersLayerRef.current);
                    }
                });

            }, [filteredWalks]);

            return (
                <div className="h-screen flex flex-col">
                    <nav className="fixed top-0 w-full z-50 bg-white/90 backdrop-blur-md border-b border-slate-100 h-20 flex items-center justify-between px-4 md:px-8">
                        <div className="flex items-center space-x-3 cursor-pointer" onClick={() => window.location.href='index.html'}>
                            <div className="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center">
                                <Icon name="camera" className="text-white" size={18} />
                            </div>
                            <span className="font-black text-lg md:text-xl tracking-tighter uppercase hidden md:inline">NorthernPixl</span>
                            <span className="font-black text-lg md:text-xl tracking-tighter uppercase md:hidden">NP</span>
                        </div>
                        <div className="flex space-x-4 md:space-x-10 text-[10px] md:text-[11px] font-black uppercase tracking-widest text-slate-400">
                            <a href="index.html" className="hover:text-black font-bold">Home</a>
                            <a href="learn.html" className="hover:text-black">Learn</a>
                            <a href="explore.html" className="hover:text-black">Explore</a>
                            <a href="routes.html" className="text-black border-b-2 border-black">Routes</a>
                            <a href="ethics.html" className="hover:text-black">Ethics</a>
                            <a href="tuition.html" className="hover:text-black">Tuition</a>
                        </div>
                    </nav>

                    <main className="flex-1 pt-20 relative">
                        <div ref={mapContainerRef} className="w-full h-full" />
                        
                        {/* Legend Overlay & Filter */}
                        <div className="absolute bottom-8 left-8 z-[400] flex flex-col gap-4">
                            
                            {/* Filter Controls */}
                            <div className="bg-white p-2 rounded-2xl shadow-xl border border-slate-100 flex gap-2">
                                <button onClick={() => setActiveFilter('all')} className={`filter-btn px-3 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors ${activeFilter === 'all' ? 'active' : 'hover:bg-slate-200'}`}>All</button>
                                <button onClick={() => setActiveFilter('1-4')} className={`filter-btn px-3 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors ${activeFilter === '1-4' ? 'active' : 'hover:bg-slate-200'}`}>Short</button>
                                <button onClick={() => setActiveFilter('4-7')} className={`filter-btn px-3 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors ${activeFilter === '4-7' ? 'active' : 'hover:bg-slate-200'}`}>Med</button>
                                <button onClick={() => setActiveFilter('7+')} className={`filter-btn px-3 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors ${activeFilter === '7+' ? 'active' : 'hover:bg-slate-200'}`}>Long</button>
                            </div>

                            {/* New Group Link Button */}
                            {activeFilter !== 'all' && (
                                <a 
                                    href={
                                        activeFilter === '1-4' ? 'walks_short.html' :
                                        activeFilter === '4-7' ? 'walks_medium.html' :
                                        'walks_long.html'
                                    }
                                    className="bg-slate-900 text-white px-4 py-3 rounded-2xl shadow-xl border border-slate-900 flex items-center justify-between group hover:bg-slate-800 transition-all no-underline"
                                >
                                    <span className="font-bold text-xs uppercase tracking-widest mr-3">
                                        View {activeFilter === '1-4' ? 'Short' : activeFilter === '4-7' ? 'Medium' : 'Long'} Walks
                                    </span>
                                    <Icon name="arrowRight" size={16} />
                                </a>
                            )}

                            <div className="bg-white p-4 rounded-2xl shadow-xl border border-slate-100">
                                <h3 className="font-black text-xs uppercase tracking-widest mb-3">Route Key</h3>
                                <div className="space-y-2">
                                    <div className="flex items-center">
                                        <span className="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                        <span className="text-xs font-bold text-slate-600">1-4 Miles</span>
                                    </div>
                                    <div className="flex items-center">
                                        <span className="w-3 h-3 rounded-full bg-amber-500 mr-2"></span>
                                        <span className="text-xs font-bold text-slate-600">4-7 Miles</span>
                                    </div>
                                    <div className="flex items-center">
                                        <span className="w-3 h-3 rounded-full bg-red-500 mr-2"></span>
                                        <span className="text-xs font-bold text-slate-600">7+ Miles</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
